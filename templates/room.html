<!DOCTYPE html>
<html lang="en">
<head>
    <title>Room {{ state['room_key'] }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        function pollGameState() {
            fetch('/room/{{ state['room_key'] }}')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(html => {
                    document.body.innerHTML = html;
                    setTimeout(pollGameState, 2000);
                })
                .catch(error => {
                    console.error('Error polling game state:', error);
                });
        }
        window.onload = pollGameState;
    </script>
</head>
<body>
    <div class="container mt-5">
        <h1>Room {{ state['room_key'] }}</h1>
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="alert alert-info">
                    {{ messages[-1] }}
                </div>
            {% endif %}
        {% endwith %}
        <p><strong>Phase:</strong> {{ state['phase'] }}</p>
        <p><strong>Your Role:</strong> {{ state['role'] }}</p>
        <p><strong>Your Name:</strong> {{ state['name'] }}</p>
        <p><strong>Alive Players:</strong> {{ state['alive'] | join(', ') }}</p>
        <p><strong>Total Players:</strong> {{ state['player_count'] }}</p>
        {% if state['hacker_ids'] %}
            <p><strong>Hacker Team:</strong> {{ state['hacker_ids'] | join(', ') }}</p>
        {% endif %}
        {% if state['instructions'] %}
            <p><strong>Instructions:</strong><br>{{ state['instructions'] }}</p>
        {% endif %}
        {% if state['phase'] == 'night' %}
            <p><strong>Terminal Access:</strong> Coming soon (use restricted terminals for commands).</p>
        {% else %}
            <p>Waiting for more players...</p>
        {% endif %}
        <a href="{{ url_for('home') }}" class="btn btn-link">Leave Room</a>
    </div>
</body>
</html>